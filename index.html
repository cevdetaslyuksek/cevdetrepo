<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mini Traffic Racer</title>

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  touch-action: none;
}

#info {
  position: absolute;
  top: 10px;
  width: 100%;
  text-align: center;
  font-size: 14px;
  z-index: 10;
}

canvas {
  background: #333;
  border: 2px solid #555;
}
</style>
</head>

<body>

<div id="info">
  Skor: <span id="score">0</span>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

canvas.width = Math.min(400, window.innerWidth);
canvas.height = Math.min(600, window.innerHeight);

const laneCount = 3;
const laneWidth = canvas.width / laneCount;

let speed = 6; // ðŸš€ daha hÄ±zlÄ± baÅŸlangÄ±Ã§
let score = 0;
let lives = 3;
let gameOver = false;

/* ===== SHAKE ===== */
let shakeTime = 0;
let shakeStrength = 8;

/* ===== IMAGES ===== */
const playerImg = new Image();
playerImg.src = "player.png";

const enemyImages = [];
["enemy1.png", "enemy2.png"].forEach(src => {
  const img = new Image();
  img.src = src;
  enemyImages.push(img);
});

const explosionImg = new Image();
explosionImg.src = "crash.png";

/* ===== SOUND ===== */
const engineSound = new Audio("engine.mp3");
engineSound.loop = true;
engineSound.volume = 0.4;

const crashSound = new Audio("crash.mp3");
crashSound.volume = 0.7;

const explosionSound = new Audio("explosion.mp3");
explosionSound.volume = 1;

/* ===== PLAYER ===== */
const player = {
  lane: 1,
  y: canvas.height - 140,
  width: laneWidth - 30,
  height: 110
};

/* ===== ENEMIES ===== */
let enemies = [];
let explosions = [];

function spawnEnemy() {
  enemies.push({
    lane: Math.floor(Math.random() * laneCount),
    y: -150,
    width: laneWidth - 30,
    height: 110,
    img: enemyImages[Math.floor(Math.random() * enemyImages.length)],
    hit: false
  });
}

/* ===== ROAD ===== */
function drawRoad() {
  ctx.fillStyle = "#444";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = "#fff";
  ctx.setLineDash([20, 20]);

  for (let i = 1; i < laneCount; i++) {
    ctx.beginPath();
    ctx.moveTo(i * laneWidth, 0);
    ctx.lineTo(i * laneWidth, canvas.height);
    ctx.stroke();
  }

  ctx.setLineDash([]);
}

/* ===== COLLISION (GERÃ‡EK HÄ°TBOX) ===== */
function collide(a, b) {
  const ax = a.lane * laneWidth + 15;
  const bx = b.lane * laneWidth + 15;

  return (
    ax < bx + b.width - 10 &&
    ax + a.width - 10 > bx &&
    a.y < b.y + b.height - 10 &&
    a.y + a.height - 10 > b.y
  );
}

/* ===== EXPLOSION ===== */
function createExplosion(x, y) {
  explosions.push({ x, y, size: 40, life: 20 });
  explosionSound.currentTime = 0;
  explosionSound.play();
}

/* ===== GAME LOOP ===== */
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (shakeTime > 0) {
    shakeTime--;
    ctx.save();
    ctx.translate(
      (Math.random() - 0.5) * shakeStrength,
      (Math.random() - 0.5) * shakeStrength
    );
  }

  drawRoad();

  // Player
  ctx.drawImage(
    playerImg,
    player.lane * laneWidth + 10,
    player.y,
    player.width,
    player.height
  );

  // Enemies
  enemies.forEach(e => {
    e.y += speed;

    ctx.drawImage(
      e.img,
      e.lane * laneWidth + 10,
      e.y,
      e.width,
      e.height
    );

    if (!e.hit && collide(player, e)) {
      e.hit = true;
      lives--;

      shakeTime = 15;
      crashSound.currentTime = 0;
      crashSound.play();

      if (lives <= 0) {
        createExplosion(
          player.lane * laneWidth + laneWidth / 2,
          player.y
        );
        gameOver = true;
        engineSound.pause();
      }
    }
  });

  // Explosions
  explosions.forEach(ex => {
    ex.life--;
    ex.size += 2;

    ctx.globalAlpha = ex.life / 20;
    ctx.drawImage(
      explosionImg,
      ex.x - ex.size / 2,
      ex.y - ex.size / 2,
      ex.size,
      ex.size
    );
    ctx.globalAlpha = 1;
  });

  explosions = explosions.filter(e => e.life > 0);

  enemies = enemies.filter(e => e.y < canvas.height + 200);

  // Score
  score++;
  scoreEl.textContent = score;

  // Speed ramp
  if (score % 150 === 0) speed += 0.7;

  // Lives UI
  ctx.fillStyle = "#fff";
  ctx.fillText("â¤ï¸ " + lives, 10, 20);

  if (shakeTime > 0) ctx.restore();

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#fff";
    ctx.font = "24px Arial";
    ctx.textAlign = "center";
    ctx.fillText("OYUN BÄ°TTÄ°", canvas.width / 2, 300);
    ctx.font = "14px Arial";
    ctx.fillText("Tekrar baÅŸlamak iÃ§in dokun", canvas.width / 2, 340);
  }
}

/* ===== CONTROLS ===== */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" && player.lane > 0) player.lane--;
  if (e.key === "ArrowRight" && player.lane < laneCount - 1) player.lane++;
});

/* ===== SWIPE ===== */
let touchStartX = 0;
canvas.addEventListener("touchstart", e => touchStartX = e.touches[0].clientX);
canvas.addEventListener("touchend", e => {
  const diff = e.changedTouches[0].clientX - touchStartX;
  if (diff > 40 && player.lane < laneCount - 1) player.lane++;
  if (diff < -40 && player.lane > 0) player.lane--;
});

/* ===== RESTART ===== */
canvas.addEventListener("click", () => {
  if (gameOver) {
    enemies = [];
    explosions = [];
    score = 0;
    lives = 3;
    speed = 6;
    gameOver = false;
    engineSound.play();
  }
});

/* ===== START ===== */
engineSound.play();
setInterval(update, 1000 / 60);
setInterval(spawnEnemy, 900);
</script>

</body>
</html>

