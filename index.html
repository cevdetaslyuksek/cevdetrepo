<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mini Traffic Racer</title>

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  touch-action: none;
}

#info {
  position: absolute;
  top: 10px;
  width: 100%;
  text-align: center;
  font-size: 14px;
  z-index: 10;
}

canvas {
  background: #333;
  border: 2px solid #555;
}
</style>
</head>

<body>

<div id="info">
  ⬅️ ➡️ Kaydır | Skor: <span id="score">0</span>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

canvas.width = Math.min(400, window.innerWidth);
canvas.height = Math.min(600, window.innerHeight);

const laneCount = 3;
const laneWidth = canvas.width / laneCount;

let speed = 4;
let score = 0;
let lives = 3;
let gameOver = false;

/* ===== SCREEN SHAKE ===== */
let shakeTime = 0;
let shakeStrength = 6;

/* ===== IMAGES ===== */
const playerImg = new Image();
playerImg.src = "player.png";

const enemyImages = [];
["enemy1.png", "enemy2.png"].forEach(src => {
  const img = new Image();
  img.src = src;
  enemyImages.push(img);
});

const crashImg = new Image();
crashImg.src = "crash.png";

/* ===== SOUND ===== */
const crashSound = new Audio("crash.mp3");
crashSound.volume = 0.6;

/* ===== PLAYER ===== */
const player = {
  lane: 1,
  y: canvas.height - 140,
  width: laneWidth - 30,
  height: 110
};

/* ===== ENEMIES ===== */
let enemies = [];

function spawnEnemy() {
  const lane = Math.floor(Math.random() * laneCount);
  const img = enemyImages[Math.floor(Math.random() * enemyImages.length)];

  enemies.push({
    lane,
    y: -140,
    width: laneWidth - 30,
    height: 110,
    img,
    hit: false
  });
}

/* ===== ROAD ===== */
function drawRoad() {
  ctx.fillStyle = "#444";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = "#fff";
  ctx.setLineDash([20, 20]);
  ctx.lineWidth = 2;

  for (let i = 1; i < laneCount; i++) {
    ctx.beginPath();
    ctx.moveTo(i * laneWidth, 0);
    ctx.lineTo(i * laneWidth, canvas.height);
    ctx.stroke();
  }
  ctx.setLineDash([]);
}

/* ===== UI ===== */
function drawUI() {
  ctx.fillStyle = "#fff";
  ctx.font = "16px Arial";
  ctx.fillText("❤️ Can: " + lives, 10, 25);
}

/* ===== GAME OVER ===== */
function drawGameOver() {
  ctx.fillStyle = "rgba(0,0,0,0.8)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.drawImage(crashImg, canvas.width/2 - 100, 120, 200, 260);

  ctx.fillStyle = "#fff";
  ctx.font = "bold 26px Arial";
  ctx.textAlign = "center";
  ctx.fillText("OYUN BİTTİ", canvas.width / 2, 420);

  ctx.font = "16px Arial";
  ctx.fillText("Tekrar başlamak için dokun", canvas.width / 2, 460);
}

/* ===== COLLISION ===== */
function isColliding(a, b) {
  const margin = 18;
  return (
    a.lane === b.lane &&
    b.y + b.height - margin > a.y + margin &&
    b.y + margin < a.y + a.height - margin
  );
}

/* ===== GAME LOOP ===== */
function update() {
  if (gameOver) {
    drawGameOver();
    return;
  }

  // SCREEN SHAKE
  if (shakeTime > 0) {
    shakeTime--;
    ctx.save();
    ctx.translate(
      (Math.random() - 0.5) * shakeStrength,
      (Math.random() - 0.5) * shakeStrength
    );
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawRoad();
  drawUI();

  ctx.drawImage(
    playerImg,
    player.lane * laneWidth + 10,
    player.y,
    player.width,
    player.height
  );

  enemies.forEach(e => {
    e.y += speed;
    ctx.drawImage(
      e.img,
      e.lane * laneWidth + 10,
      e.y,
      e.width,
      e.height
    );

    if (!e.hit && isColliding(player, e)) {
      e.hit = true;
      lives--;

      // EFFECTS
      shakeTime = 15;
      crashSound.currentTime = 0;
      crashSound.play();

      if (lives <= 0) gameOver = true;
    }
  });

  enemies = enemies.filter(e => e.y < canvas.height + 150);

  score++;
  scoreEl.textContent = score;

  if (score % 200 === 0) speed += 0.5;

  if (shakeTime > 0) ctx.restore();
}

/* ===== CONTROLS ===== */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" && player.lane > 0) player.lane--;
  if (e.key === "ArrowRight" && player.lane < laneCount - 1) player.lane++;
});

/* ===== SWIPE ===== */
let touchStartX = 0;
canvas.addEventListener("touchstart", e => {
  touchStartX = e.touches[0].clientX;
});
canvas.addEventListener("touchend", e => {
  const diff = e.changedTouches[0].clientX - touchStartX;
  if (diff > 50 && player.lane < laneCount - 1) player.lane++;
  if (diff < -50 && player.lane > 0) player.lane--;
});

/* ===== RESTART ===== */
canvas.addEventListener("click", () => {
  if (gameOver) {
    enemies = [];
    score = 0;
    lives = 3;
    speed = 4;
    gameOver = false;
  }
});

/* ===== START ===== */
setInterval(update, 1000 / 60);
setInterval(spawnEnemy, 1200);
</script>

</body>
</html>
