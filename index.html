<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Flappy Bird – Çarpma Sesli</title>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #111;
    overflow: hidden;
    touch-action: manipulation;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  canvas {
    background: linear-gradient(#4ec0ca, #e0f7fa);
    border-radius: 12px;
  }

  #fsBtn {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 10;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
</style>
</head>

<body>
<canvas id="game"></canvas>
<button id="fsBtn">Tam Ekran</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ========== CANVAS ========== */
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ========== FULLSCREEN ========== */
document.getElementById("fsBtn").onclick = () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
};

/* ========== ZIPLAMA SESİ (BOUNCE) ========== */
let audioCtx = null;

function playBounceSound() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "square";
  osc.frequency.value = 520;

  gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(
    0.001,
    audioCtx.currentTime + 0.15
  );

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.15);
}

/* ========== ÇARPMA SESİ (DOSYADAN) ========== */
const crashSound = new Audio("crash.mp3");
crashSound.preload = "auto";

function playCrashSound() {
  crashSound.currentTime = 0;
  crashSound.play();
}

/* ========== KUŞ ========== */
const birdImg = new Image();
birdImg.src = "bird.png";

let bird = {
  x: 120,
  y: 260,
  w: 90,
  h: 90,
  v: 0
};

const birdHitboxRatio = { x: 0.35, y: 0.30 };

/* ========== FİZİK ========== */
const gravity = 0.13;
const jump = -6;

/* ========== BORULAR ========== */
let pipes = [];
let frame = 0;
let score = 0;
let gameOver = false;
let crashPlayed = false;

const pipeWidth = 52;
const pipePaddingRatio = 0.28;

function addPipe() {
  const gap = Math.max(150, 200 - score * 6);
  const top = Math.random() * 150 + 60;
  pipes.push({
    x: canvas.width,
    top,
    bottom: top + gap,
    passed: false
  });
}

function resetGame() {
  bird.y = canvas.height / 2;
  bird.v = 0;
  pipes = [];
  score = 0;
  frame = 0;
  gameOver = false;
  crashPlayed = false;
}

/* ========== UPDATE ========== */
function update() {
  if (gameOver) return;

  bird.v += gravity;
  bird.y += bird.v;

  if (frame % 120 === 0) addPipe();

  const speed = 1.3 + score * 0.06;
  pipes.forEach(p => p.x -= speed);
  pipes = pipes.filter(p => p.x > -pipeWidth);

  const padX = bird.w * birdHitboxRatio.x;
  const padY = bird.h * birdHitboxRatio.y;

  const bx = bird.x + padX;
  const by = bird.y + padY;
  const bw = bird.w - padX * 2;
  const bh = bird.h - padY * 2;

  pipes.forEach(p => {
    const pipePad = pipeWidth * pipePaddingRatio;
    const px1 = p.x + pipePad;
    const px2 = p.x + pipeWidth - pipePad;

    if (
      bx + bw > px1 &&
      bx < px2 &&
      (by < p.top || by + bh > p.bottom)
    ) {
      triggerGameOver();
    }

    if (!p.passed && p.x + pipeWidth < bird.x) {
      p.passed = true;
      score++;
    }
  });

  if (bird.y + bird.h > canvas.height || bird.y < 0) {
    triggerGameOver();
  }

  frame++;
}

/* ========== GAME OVER ========== */
function triggerGameOver() {
  if (!crashPlayed) {
    playCrashSound();
    crashPlayed = true;
  }
  gameOver = true;
}

/* ========== DRAW ========== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.drawImage(birdImg, bird.x, bird.y, bird.w, bird.h);

  ctx.fillStyle = "#1e8449";
  pipes.forEach(p => {
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.bottom, pipeWidth, canvas.height);
  });

  ctx.fillStyle = "#000";
  ctx.font = "20px Arial";
  ctx.fillText("Skor: " + score, 12, 28);

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#fff";
    ctx.font = "28px Arial";
    ctx.fillText("Bitti", canvas.width / 2 - 35, canvas.height / 2);
    ctx.font = "16px Arial";
    ctx.fillText(
      "Dokun / Tıkla → Tekrar",
      canvas.width / 2 - 85,
      canvas.height / 2 + 30
    );
  }
}

/* ========== LOOP ========== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/* ========== INPUT ========== */
function jumpBird() {
  if (gameOver) {
    resetGame();
  } else {
    playBounceSound();
    bird.v = jump;
  }
}

canvas.addEventListener("click", jumpBird);
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  jumpBird();
}, { passive: false });

loop();
</script>
</body>
</html>
